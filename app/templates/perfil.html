{% extends "base.html" %}

{% block title %}Mi Perfil{% endblock %}
{% block page_title %}Mi Perfil{% endblock %}
{% block page_subtitle %}Gestiona tu información personal{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-8">
    <!-- Header del Perfil Mejorado -->
    <div class="relative overflow-hidden rounded-3xl bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 shadow-2xl">
        <div class="absolute inset-0 bg-grid-white/[0.05] bg-[size:60px_60px]"></div>
        <div class="relative px-8 py-12">
            <div class="flex flex-col lg:flex-row items-center lg:items-start gap-8">
                <!-- Avatar Mejorado -->
                <div class="relative group">
                    <div class="relative">
                        <div class="w-32 h-32 bg-gradient-to-br from-purple-500 to-pink-500 rounded-3xl flex items-center justify-center text-white font-bold text-4xl shadow-2xl shadow-purple-500/30 transform group-hover:scale-105 transition-all duration-500">
                            {{ current_user.nombre[0] }}
                        </div>
                        <div class="absolute -inset-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-3xl opacity-20 blur-xl group-hover:opacity-40 transition-opacity duration-500"></div>
                    </div>
                    <div class="absolute -bottom-2 -right-2 w-10 h-10 bg-emerald-500 rounded-full border-4 border-slate-900 flex items-center justify-center shadow-lg">
                        <i class="fas fa-check text-xs text-white"></i>
                    </div>
                </div>

                <!-- Información Principal -->
                <div class="flex-1 text-center lg:text-left">
                    <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4">
                        <div>
                            <h1 class="text-4xl lg:text-5xl font-bold text-white mb-2">{{ current_user.nombre }}</h1>
                            <p class="text-purple-200 text-xl mb-4">{{ current_user.email }}</p>
                            <div class="flex flex-wrap gap-3 justify-center lg:justify-start">
                                <span class="px-4 py-2 bg-white/10 backdrop-blur-sm rounded-2xl text-white border border-white/20 flex items-center gap-2">
                                    <i class="fas fa-shield-alt"></i>
                                    {{ current_user.rol }}
                                </span>
                                <span class="px-4 py-2 bg-white/10 backdrop-blur-sm rounded-2xl text-white border border-white/20 flex items-center gap-2">
                                    <i class="fas fa-calendar-alt"></i>
                                    Miembro desde {{ current_user.fecha_creacion.strftime('%b %Y') }}
                                </span>
                            </div>
                        </div>
                        <div class="text-center lg:text-right">
                            <div class="text-purple-200 text-sm mb-1">Último acceso</div>
                            <div class="text-white font-semibold text-lg bg-white/10 backdrop-blur-sm rounded-xl px-4 py-2 border border-white/20">
                                {{ ultimo_acceso.strftime('%d/%m/%Y %H:%M') if ultimo_acceso else 'Nunca' }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estadísticas Mejoradas -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Tareas Asignadas -->
        <div class="group relative">
            <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-2xl blur opacity-30 group-hover:opacity-100 transition duration-1000 group-hover:duration-200"></div>
            <div class="relative bg-slate-900 rounded-2xl p-6 text-white">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-blue-500/20 rounded-xl backdrop-blur-sm">
                        <i class="fas fa-tasks text-2xl text-blue-400"></i>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-bold">{{ estadisticas.tareas_asignadas }}</div>
                        <div class="text-blue-300 text-sm">Asignadas</div>
                    </div>
                </div>
                <h3 class="font-semibold text-blue-300 mb-2">Tareas</h3>
                <div class="w-full bg-blue-500/20 rounded-full h-2">
                    <div class="bg-gradient-to-r from-blue-400 to-cyan-400 rounded-full h-2 transition-all duration-1000" 
                         style="width: {% if estadisticas.tareas_asignadas > 0 %}{{ ((estadisticas.tareas_completadas / estadisticas.tareas_asignadas) * 100)|round|int }}%{% else %}0%{% endif %}">
                    </div>
                </div>
            </div>
        </div>

        <!-- Tareas Completadas -->
        <div class="group relative">
            <div class="absolute -inset-0.5 bg-gradient-to-r from-emerald-500 to-green-500 rounded-2xl blur opacity-30 group-hover:opacity-100 transition duration-1000 group-hover:duration-200"></div>
            <div class="relative bg-slate-900 rounded-2xl p-6 text-white">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-emerald-500/20 rounded-xl backdrop-blur-sm">
                        <i class="fas fa-check-circle text-2xl text-emerald-400"></i>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-bold">{{ estadisticas.tareas_completadas }}</div>
                        <div class="text-emerald-300 text-sm">Completadas</div>
                    </div>
                </div>
                <h3 class="font-semibold text-emerald-300 mb-2">Completadas</h3>
                <div class="text-emerald-300 text-sm">
                    {% if estadisticas.tareas_asignadas > 0 %}
                        {{ ((estadisticas.tareas_completadas / estadisticas.tareas_asignadas) * 100)|round|int }}% de eficiencia
                    {% else %}
                        0% de eficiencia
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Proyectos Activos -->
        <div class="group relative">
            <div class="absolute -inset-0.5 bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl blur opacity-30 group-hover:opacity-100 transition duration-1000 group-hover:duration-200"></div>
            <div class="relative bg-slate-900 rounded-2xl p-6 text-white">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-purple-500/20 rounded-xl backdrop-blur-sm">
                        <i class="fas fa-project-diagram text-2xl text-purple-400"></i>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-bold">{{ estadisticas.proyectos_participando }}</div>
                        <div class="text-purple-300 text-sm">Activos</div>
                    </div>
                </div>
                <h3 class="font-semibold text-purple-300 mb-2">Proyectos</h3>
                <div class="text-purple-300 text-sm">Participando activamente</div>
            </div>
        </div>

        <!-- Eficiencia General -->
        <div class="group relative">
            <div class="absolute -inset-0.5 bg-gradient-to-r from-amber-500 to-orange-500 rounded-2xl blur opacity-30 group-hover:opacity-100 transition duration-1000 group-hover:duration-200"></div>
            <div class="relative bg-slate-900 rounded-2xl p-6 text-white">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-amber-500/20 rounded-xl backdrop-blur-sm">
                        <i class="fas fa-chart-line text-2xl text-amber-400"></i>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-bold">
                            {% if estadisticas.tareas_asignadas > 0 %}
                                {{ ((estadisticas.tareas_completadas / estadisticas.tareas_asignadas) * 100)|round|int }}%
                            {% else %}
                                0%
                            {% endif %}
                        </div>
                        <div class="text-amber-300 text-sm">Eficiencia</div>
                    </div>
                </div>
                <h3 class="font-semibold text-amber-300 mb-2">Rendimiento</h3>
                <div class="text-amber-300 text-sm">Tasa de éxito</div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Columna Izquierda - Actividad Reciente -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Actividad Reciente Mejorada -->
            <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-xl border dark:border-slate-700 overflow-hidden">
                <div class="px-8 py-6 border-b dark:border-slate-700 bg-gradient-to-r from-slate-50 to-white dark:from-slate-900 dark:to-slate-800">
                    <div class="flex items-center justify-between">
                        <h3 class="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-3">
                            <div class="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-xl">
                                <i class="fas fa-history text-purple-600 dark:text-purple-400"></i>
                            </div>
                            Actividad Reciente
                        </h3>
                        <span class="px-3 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-full text-sm font-medium">
                            {{ actividad_reciente|length }} actividades
                        </span>
                    </div>
                </div>
                <div class="p-6">
                    {% if actividad_reciente %}
                        <div class="space-y-4">
                            {% for actividad in actividad_reciente %}
                            <div class="group flex items-start gap-4 p-4 rounded-2xl hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-all duration-300 border border-transparent hover:border-slate-200 dark:hover:border-slate-600">
                                <div class="flex-shrink-0 w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white transform group-hover:scale-110 transition-transform duration-300">
                                    <i class="fas fa-{{ actividad.icono }}"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-slate-900 dark:text-white font-medium text-lg">{{ actividad.descripcion }}</p>
                                    <p class="text-slate-500 dark:text-slate-400 text-sm mt-1">{{ actividad.fecha }}</p>
                                </div>
                                <div class="flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                    <div class="w-3 h-3 bg-purple-500 rounded-full animate-pulse"></div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-16">
                            <div class="w-20 h-20 bg-slate-100 dark:bg-slate-700 rounded-3xl flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-stream text-3xl text-slate-400"></i>
                            </div>
                            <h4 class="text-xl font-semibold text-slate-900 dark:text-white mb-2">No hay actividad reciente</h4>
                            <p class="text-slate-500 dark:text-slate-400">Tu actividad aparecerá aquí cuando realices acciones en el sistema</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Columna Derecha - Paneles Informativos -->
        <div class="space-y-8">
            <!-- Información de la Cuenta Mejorada -->
            <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-xl border dark:border-slate-700 overflow-hidden">
                <div class="px-6 py-5 border-b dark:border-slate-700 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20">
                    <h3 class="text-xl font-bold text-slate-900 dark:text-white flex items-center gap-3">
                        <div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-xl">
                            <i class="fas fa-user-cog text-blue-600 dark:text-blue-400"></i>
                        </div>
                        Información de la Cuenta
                    </h3>
                </div>
                <div class="p-6 space-y-4">
                    <div class="flex items-center justify-between p-4 rounded-2xl bg-slate-50 dark:bg-slate-700/50">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-2xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                                <i class="fas fa-id-card text-blue-600 dark:text-blue-400"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-slate-500 dark:text-slate-400">ID de Usuario</p>
                                <p class="text-slate-900 dark:text-white font-mono font-semibold">#{{ current_user.id }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-between p-4 rounded-2xl bg-slate-50 dark:bg-slate-700/50">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-2xl bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center">
                                <i class="fas fa-shield-check text-emerald-600 dark:text-emerald-400"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-slate-500 dark:text-slate-400">Estado</p>
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400">
                                    <i class="fas fa-check-circle mr-1"></i>
                                    Activa
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-between p-4 rounded-2xl bg-slate-50 dark:bg-slate-700/50">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-2xl bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center">
                                <i class="fas fa-calendar-day text-purple-600 dark:text-purple-400"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-slate-500 dark:text-slate-400">Registro</p>
                                <p class="text-slate-900 dark:text-white font-semibold">{{ current_user.fecha_creacion.strftime('%d/%m/%Y') }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Acciones Rápidas Mejoradas -->
            <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-xl border dark:border-slate-700 overflow-hidden">
                <div class="px-6 py-5 border-b dark:border-slate-700 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20">
                    <h3 class="text-xl font-bold text-slate-900 dark:text-white flex items-center gap-3">
                        <div class="p-2 bg-amber-100 dark:bg-amber-900/30 rounded-xl">
                            <i class="fas fa-bolt text-amber-600 dark:text-amber-400"></i>
                        </div>
                        Acciones Rápidas
                    </h3>
                </div>
                <div class="p-6 space-y-4">
                    <a href="{{ url_for('configuracion.settings') }}" class="group flex items-center gap-4 p-4 rounded-2xl border-2 border-slate-200 dark:border-slate-600 hover:border-purple-500 dark:hover:border-purple-500 hover:shadow-lg transition-all duration-300 bg-gradient-to-r from-white to-slate-50 dark:from-slate-700 dark:to-slate-800">
                        <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white transform group-hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-cog"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-bold text-slate-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400 text-lg">Configuración</p>
                            <p class="text-slate-500 dark:text-slate-400 text-sm">Ajustes y preferencias</p>
                        </div>
                        <i class="fas fa-chevron-right text-slate-400 group-hover:text-purple-500 transform group-hover:translate-x-2 transition-all duration-300 text-lg"></i>
                    </a>

                    <a href="{{ url_for('tarea.listar_tareas') }}" class="group flex items-center gap-4 p-4 rounded-2xl border-2 border-slate-200 dark:border-slate-600 hover:border-blue-500 dark:hover:border-blue-500 hover:shadow-lg transition-all duration-300 bg-gradient-to-r from-white to-slate-50 dark:from-slate-700 dark:to-slate-800">
                        <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white transform group-hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-bold text-slate-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 text-lg">Mis Tareas</p>
                            <p class="text-slate-500 dark:text-slate-400 text-sm">Ver asignaciones</p>
                        </div>
                        <i class="fas fa-chevron-right text-slate-400 group-hover:text-blue-500 transform group-hover:translate-x-2 transition-all duration-300 text-lg"></i>
                    </a>

                    <a href="{{ url_for('proyecto.listar_proyectos') }}" class="group flex items-center gap-4 p-4 rounded-2xl border-2 border-slate-200 dark:border-slate-600 hover:border-emerald-500 dark:hover:border-emerald-500 hover:shadow-lg transition-all duration-300 bg-gradient-to-r from-white to-slate-50 dark:from-slate-700 dark:to-slate-800">
                        <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-emerald-500 to-green-500 flex items-center justify-center text-white transform group-hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-bold text-slate-900 dark:text-white group-hover:text-emerald-600 dark:group-hover:text-emerald-400 text-lg">Proyectos</p>
                            <p class="text-slate-500 dark:text-slate-400 text-sm">Explorar proyectos</p>
                        </div>
                        <i class="fas fa-chevron-right text-slate-400 group-hover:text-emerald-500 transform group-hover:translate-x-2 transition-all duration-300 text-lg"></i>
                    </a>
                </div>
            </div>

            <!-- Logros Mejorados -->
            <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-xl border dark:border-slate-700 overflow-hidden">
                <div class="px-6 py-5 border-b dark:border-slate-700 bg-gradient-to-r from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20">
                    <h3 class="text-xl font-bold text-slate-900 dark:text-white flex items-center gap-3">
                        <div class="p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-xl">
                            <i class="fas fa-trophy text-yellow-600 dark:text-yellow-400"></i>
                        </div>
                        Logros
                    </h3>
                </div>
                <div class="p-6 space-y-4">
                    <div class="group flex items-center gap-4 p-4 rounded-2xl bg-gradient-to-r from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20 border-2 border-yellow-200 dark:border-yellow-700 transform hover:scale-105 transition-transform duration-300">
                        <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-yellow-500 to-amber-500 flex items-center justify-center text-white shadow-lg">
                            <i class="fas fa-star"></i>
                        </div>
                        <div>
                            <p class="font-bold text-slate-900 dark:text-white">Primeros Pasos</p>
                            <p class="text-slate-600 dark:text-slate-300 text-sm">Completar primera tarea</p>
                        </div>
                    </div>

                    <div class="group flex items-center gap-4 p-4 rounded-2xl bg-slate-50 dark:bg-slate-700/50 border-2 border-slate-200 dark:border-slate-600 opacity-60">
                        <div class="w-14 h-14 rounded-2xl bg-slate-400 flex items-center justify-center text-white">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <div>
                            <p class="font-bold text-slate-500 dark:text-slate-400">Productivo</p>
                            <p class="text-slate-400 text-sm">10 tareas completadas</p>
                        </div>
                    </div>

                    <div class="group flex items-center gap-4 p-4 rounded-2xl bg-slate-50 dark:bg-slate-700/50 border-2 border-slate-200 dark:border-slate-600 opacity-60">
                        <div class="w-14 h-14 rounded-2xl bg-slate-400 flex items-center justify-center text-white">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div>
                            <p class="font-bold text-slate-500 dark:text-slate-400">Líder</p>
                            <p class="text-slate-400 text-sm">Dirigir un proyecto</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Animaciones personalizadas */
    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }

    @keyframes glow {
        0%, 100% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.4); }
        50% { box-shadow: 0 0 40px rgba(168, 85, 247, 0.8); }
    }

    .floating {
        animation: float 6s ease-in-out infinite;
    }

    .glowing {
        animation: glow 3s ease-in-out infinite;
    }

    /* Efectos de gradiente animado */
    .gradient-border {
        position: relative;
        background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
    }

    @keyframes gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* Mejoras de scroll */
    .smooth-scroll {
        scroll-behavior: smooth;
    }

    /* Efectos de profundidad */
    .depth-card {
        box-shadow: 
            0 10px 40px -10px rgba(0, 0, 0, 0.1),
            0 0 0 1px rgba(255, 255, 255, 0.1);
    }

    .dark .depth-card {
        box-shadow: 
            0 10px 40px -10px rgba(0, 0, 0, 0.3),
            0 0 0 1px rgba(255, 255, 255, 0.05);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Animación de conteo mejorada para estadísticas
        const statNumbers = document.querySelectorAll('.text-3xl.font-bold');
        statNumbers.forEach(stat => {
            const finalValue = parseInt(stat.textContent.replace('%', ''));
            let currentValue = 0;
            const duration = 2000;
            const increment = finalValue / (duration / 16);
            const isPercentage = stat.textContent.includes('%');
            
            const timer = setInterval(() => {
                currentValue += increment;
                if (currentValue >= finalValue) {
                    currentValue = finalValue;
                    clearInterval(timer);
                }
                stat.textContent = isPercentage ? 
                    Math.floor(currentValue) + '%' : 
                    Math.floor(currentValue);
            }, 16);
        });

        // Efecto de aparición escalonada para elementos
        const animateOnScroll = (entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                    observer.unobserve(entry.target);
                }
            });
        };

        const observer = new IntersectionObserver(animateOnScroll, {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        });

        // Observar elementos para animación
        document.querySelectorAll('.group, .stat-card, .activity-item').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(30px)';
            el.style.transition = 'all 0.6s ease';
            observer.observe(el);
        });

        // Efectos de hover mejorados
        const interactiveCards = document.querySelectorAll('.group.relative');
        interactiveCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-8px) scale(1.02)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });

        // Parallax effect para el header
        const header = document.querySelector('.relative.overflow-hidden');
        if (header) {
            window.addEventListener('scroll', () => {
                const scrolled = window.pageYOffset;
                const rate = scrolled * -0.5;
                header.style.transform = `translateY(${rate}px)`;
            });
        }
    });
</script>
{% endblock %}